<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>ä¸»æ§ä¸“å± - æœºå™¨äººç¾¤èŠä¸­å¿ƒ</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body {
      margin:0;padding:16px;
      background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height:100vh;
      font-family:Arial,sans-serif;
      color:#fff;
      overflow-x:hidden;
    }
    .container {
      max-width:1100px;
      margin:20px auto;
      display:flex;
      gap:16px;
      padding:8px;
    }
    /* æœºå™¨äººåˆ—è¡¨é¢æ¿ */
    .robot-list {
      flex:1;
      background:rgba(255,255,255,0.08);
      border-radius:16px;
      padding:20px;
      backdrop-filter:blur(12px);
      border:1px solid rgba(255,255,255,0.15);
      box-shadow:0 8px 32px rgba(0,0,0,0.1);
    }
    .robot-list h2 {
      text-align:center;
      margin-bottom:20px;
      font-size:18px;
      font-weight:600;
      color:#e0e7ff;
    }
    .robot-item {
      padding:14px 12px;
      margin:10px 0;
      border-radius:12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      background:rgba(255,255,255,0.05);
      border:1px solid rgba(255,255,255,0.1);
      transition:all 0.2s;
    }
    .robot-item:hover {transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.1);}
    .online {border-left:4px solid #34d399;background:rgba(52,211,153,0.1);}
    .online .status {color:#34d399;font-size:12px;}
    .offline {border-left:4px solid #f87171;background:rgba(248,113,113,0.1);}
    .offline .status {color:#f87171;font-size:12px;}
    .robot-info {display:flex;flex-direction:column;gap:4px;}
    .robot-id {font-size:12px;opacity:0.7;}
    .robot-name {font-weight:500;}
    .btn-sm {
      padding:5px 10px;border:none;border-radius:8px;margin:0 3px;
      cursor:pointer;font-size:12px;font-weight:500;transition:all 0.2s;
    }
    .start {background:#34d399;color:#065f46;}
    .start:hover {background:#2dd4a1;}
    .stop {background:#f87171;color:#991b1b;}
    .stop:hover {background:#fca5a5;}
    /* ç¾¤èŠé¢æ¿ */
    .chat-area {
      flex:3;
      background:rgba(255,255,255,0.08);
      border-radius:16px;
      padding:24px;
      backdrop-filter:blur(12px);
      border:1px solid rgba(255,255,255,0.15);
      box-shadow:0 8px 32px rgba(0,0,0,0.1);
    }
    .chat-header {
      display:flex;justify-content:space-between;align-items:center;
      padding-bottom:16px;border-bottom:1px solid rgba(255,255,255,0.1);margin-bottom:20px;
    }
    .chat-header h2 {font-size:20px;font-weight:600;color:#e0e7ff;}
    .chat-content {
      height:480px;overflow-y:auto;padding:16px;background:rgba(0,0,0,0.1);
      border-radius:12px;margin:10px 0;scrollbar-width:thin;
    }
    .chat-content::-webkit-scrollbar {width:6px;}
    .chat-content::-webkit-scrollbar-thumb {background:rgba(255,255,255,0.2);border-radius:3px;}
    /* æ¶ˆæ¯æ°”æ³¡ */
    .chat-msg {
      margin:12px 0;padding:12px 16px;border-radius:14px;max-width:75%;
      line-height:1.5;position:relative;
    }
    .robot-msg {
      background:rgba(59,130,246,0.25);border:1px solid rgba(59,130,246,0.3);
      text-align:left;margin-right:auto;border-bottom-left-radius:4px;
    }
    .master-msg {
      background:rgba(52,211,153,0.25);border:1px solid rgba(52,211,153,0.3);
      text-align:right;margin-left:auto;border-bottom-right-radius:4px;
    }
    .msg-sender {font-weight:600;font-size:14px;}
    .msg-time {font-size:11px;opacity:0.6;margin-top:4px;display:block;}
    .msg-content {margin-top:6px;font-size:15px;}
    /* è¾“å…¥åŒº */
    .input-area {display:flex;gap:12px;margin-top:20px;}
    #chatInput {
      flex:1;padding:14px 16px;border:none;border-radius:12px;
      background:rgba(255,255,255,0.1);color:#fff;font-size:15px;
      border:1px solid rgba(255,255,255,0.1);outline:none;transition:all 0.2s;
    }
    #chatInput:focus {border-color:rgba(255,255,255,0.3);background:rgba(255,255,255,0.15);}
    #chatInput::placeholder {color:rgba(255,255,255,0.5);}
    .btn {
      padding:14px 24px;border:none;border-radius:12px;cursor:pointer;color:#fff;
      font-size:15px;font-weight:500;transition:all 0.2s;border:1px solid transparent;
    }
    .btn-all {
      background:rgba(249,115,22,0.2);border-color:rgba(249,115,22,0.3);
      color:#fcd34d;width:100%;margin:6px 0;
    }
    .btn-all:hover {background:rgba(249,115,22,0.3);}
    .btn-send {
      background:rgba(59,130,246,0.3);border-color:rgba(59,130,246,0.4);
      color:#bfdbfe;min-width:100px;
    }
    .btn-send:hover {background:rgba(59,130,246,0.4);}
    .btn-clear {
      background:rgba(239,68,68,0.2);border-color:rgba(239,68,68,0.3);
      color:#fca5a5;
    }
    .btn-clear:hover {background:rgba(239,68,68,0.3);}
    /* æ‰‹æœºé€‚é… */
    @media (max-width:768px) {.container{flex-direction:column;}.chat-content{height:350px;}}
  </style>
  <!-- å¿…é¡»æŒ‰è¿™ä¸ªé¡ºåºå¼•ç”¨ï¼Œä¸ç„¶ä¼šç©ºç™½ï¼ -->
  <script src="safe.js"></script>
  <script src="robot_chat.js"></script>
</head>
<body>
  <!-- ä¸»æ§æƒé™æ ¡éªŒï¼Œéä¸»æ§è·³è½¬ç™»å½• -->
  <script>
    function checkMasterAuth() {
      const isMaster = localStorage.getItem("isMaster") === "true";
      if (!isMaster) {
        alert("âŒ ä»…ä¸»æ§å¯è§ï¼è¯·å…ˆç™»å½•ä¸»æ§è´¦å·");
        window.location.href = "admin.html";
        return false;
      }
      return true;
    }
    // é¡µé¢åŠ è½½å…ˆæ ¡éªŒï¼Œé€šè¿‡å†æ¸²æŸ“å†…å®¹ï¼Œé¿å…ç©ºç™½
    window.onload = function() {
      if(checkMasterAuth()){
        refreshRobotList();
        refreshGroupChat();
        localStorage.setItem("isMaster", "true");
      }
    }
  </script>

  <div class="container">
    <!-- 8å¤§æœºå™¨äººåˆ—è¡¨ -->
    <div class="robot-list">
      <h2>ğŸ¤– 8å¤§æœºå™¨äººç®¡æ§</h2>
      <button class="btn btn-all" onclick="startAllRobots()">ğŸš€ å¯åŠ¨å…¨éƒ¨æœºå™¨äºº</button>
      <button class="btn btn-all" onclick="stopAllRobots()">ğŸ›‘ åœæ­¢å…¨éƒ¨æœºå™¨äºº</button>
      <div id="robotList"></div>
    </div>

    <!-- ç¾¤èŠåŒºåŸŸï¼ˆä¸ä¼šç©ºç™½ï¼Œæ— æ¶ˆæ¯ä¹Ÿæœ‰æç¤ºï¼‰ -->
    <div class="chat-area">
      <div class="chat-header">
        <h2>ä¸»æ§ä¸“å±æœºå™¨äººç¾¤èŠï¼ˆä»…ä¸»æ§å¯è§ï¼‰</h2>
        <button class="btn btn-clear" onclick="clearChatRecords()">æ¸…ç©ºè®°å½•</button>
      </div>
      <div class="chat-content" id="chatContent"></div>
      <div class="input-area">
        <input type="text" id="chatInput" placeholder="è¾“å…¥æŒ‡ä»¤ï¼Œåœ¨çº¿æœºå™¨äººè‡ªåŠ¨åº”ç­” ğŸ“©">
        <button class="btn btn-send" onclick="sendMasterChat()">å‘é€</button>
      </div>
    </div>
  </div>

  <script>
    // å¯åœå…¨éƒ¨æœºå™¨äººï¼ˆç¡®ä¿æœ‰æ¶ˆæ¯è¾“å‡ºï¼Œä¸ç©ºç™½ï¼‰
    function startAllRobots() {
      robotGroup.forEach(robot => robot.status = "åœ¨çº¿");
      sendGroupChat("master", "ä¸»æ§", "ğŸš€ å¯åŠ¨å…¨éƒ¨æœºå™¨äººï¼Œå„å¸å…¶èŒï¼Œä¸¥å®ˆå²—ä½ï¼");
      refreshRobotList();
      refreshGroupChat();
      alert("âœ… 8å¤§æœºå™¨äººå…¨éƒ¨å¯åŠ¨å°±ç»ª");
    }
    function stopAllRobots() {
      robotGroup.forEach(robot => robot.status = "ç¦»çº¿");
      sendGroupChat("master", "ä¸»æ§", "ğŸ›‘ å…¨éƒ¨æœºå™¨äººåœæ­¢è¿è¡Œï¼ŒåŸåœ°å¾…å‘½ï¼");
      refreshRobotList();
      refreshGroupChat();
      alert("âŒ 8å¤§æœºå™¨äººå·²åœæ­¢å¾…å‘½");
    }

    // ä¸»æ§å‘æ¶ˆæ¯ï¼ˆå¿…å‡ºå†…å®¹ï¼Œæœç»ç©ºç™½ï¼‰
    function sendMasterChat() {
      const content = document.getElementById("chatInput").value.trim();
      if (!content) {alert("æŒ‡ä»¤ä¸èƒ½ä¸ºç©ºï¼");return;}
      sendGroupChat("master", "ä¸»æ§", content);
      robotAutoReply({senderType:"master", content:content});
      document.getElementById("chatInput").value = "";
      refreshGroupChat();
    }

    // æ¸…ç©ºè®°å½•
    function clearChatRecords() {
      if(confirm("âš ï¸ ç¡®è®¤æ¸…ç©ºç¾¤èŠè®°å½•ï¼Ÿæ¸…ç©ºåä¸å¯æ¢å¤")){
        groupChatRecords = [];
        refreshGroupChat();
      }
    }
  </script>
</body>
</html>