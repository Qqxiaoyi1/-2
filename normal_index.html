<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ™®é€šç”¨æˆ·é¡µ - ä¸»æ§é¢‘é“</title>
  <style>
    body {margin:0;padding:20px;background:linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%);font-family:Arial,sans-serif;color:#333;}
    .container {max-width:800px;margin:30px auto;padding:25px;background:#fff;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.1);}
    h2 {color:#4CAF50;border-bottom:2px solid #eee;padding-bottom:10px;margin-bottom:20px;text-align:center;}
    .post-card {padding:15px;border:1px solid #eee;border-radius:8px;margin:15px 0;}
    .post-card h3 {color:#333;margin:0 0 8px;}
    .post-info {font-size:12px;color:#999;margin-bottom:10px;}
    .post-content {line-height:1.6;color:#666;margin:10px 0;}
    .like-btn {padding:6px 12px;border:none;border-radius:4px;background:#f44336;color:#fff;cursor:pointer;margin-top:8px;}
    .like-btn:hover {background:#d32f2f;}
    .like-count {color:#f44336;margin-left:10px;}
    .comment-area {margin-top:15px;padding-top:15px;border-top:1px dashed #eee;}
    .comment-input {width:100%;padding:8px;border:1px solid #eee;border-radius:4px;margin:8px 0;resize:none;height:60px;}
    .comment-btn {padding:6px 12px;border:none;border-radius:4px;background:#4CAF50;color:#fff;cursor:pointer;}
    .comment-list {margin-top:10px;max-height:150px;overflow-y:auto;}
    .comment-item {font-size:13px;padding:6px 0;border-bottom:1px solid #f5f5f5;}
    .comment-name {color:#4CAF50;font-weight:bold;}
    .comment-time {color:#999;font-size:11px;margin-left:8px;}
    .btn {padding:10px 20px;border:none;border-radius:6px;background:#4CAF50;color:#fff;cursor:pointer;margin:10px 0;}
    .tips {color:#999;font-size:13px;text-align:center;margin-top:20px;}
  </style>
  <script src="safe.js"></script>
</head>
<body>
  <div class="container">
    <h2>ğŸ“¢ ä¸»æ§é¢‘é“ï¼ˆå…¨ç«™å…¬å¼€ï¼‰</h2>
    <button class="btn" onclick="refreshChannelPosts()">åˆ·æ–°é¢‘é“å†…å®¹</button>
    <div id="channelList"></div>
    <p class="tips">æ™®é€šç”¨æˆ·å¯æµè§ˆ+ç‚¹èµ+è¯„è®ºï¼Œä¸»æ§å‘å¸ƒå†…å®¹å®æ—¶åŒæ­¥</p>
    <button class="btn" onclick="window.location.href='admin.html'">è¿”å›ç™»å½•é¡µ</button>
  </div>

  <script>
    // æ™®é€šç”¨æˆ·IDï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
    const normalUserId = "user_" + Math.random().toString(36).substr(2, 8);
    console.log("ä½ çš„ç”¨æˆ·IDï¼š", normalUserId);

    // æ™®é€šç”¨æˆ·å‘è¯„è®º
    function doNormalComment(postId){
      const content = prompt("è¯·è¾“å…¥ä½ çš„è¯„è®º");
      const res = publishComment(postId, normalUserId, "normal", content);
      alert(res);
      refreshChannelPosts();
    }

    // åˆ·æ–°é¢‘é“+ç‚¹èµ+è¯„è®º
    function refreshChannelPosts() {
      const list = document.getElementById('channelList');
      if(channelPosts.length === 0){
        list.innerHTML = "<p style='text-align:center;color:#999;'>æš‚æ— ä¸»æ§å‘å¸ƒå†…å®¹</p>";
        return;
      }
      let html = "";
      channelPosts.forEach(post => {
        const comments = getCommentsByPostId(post.id);
        let commentHtml = "<div class='comment-item'>æš‚æ— è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘~</div>";
        if(comments.length>0){
          commentHtml = comments.map(c=>`
            <div class="comment-item">
              <span class="comment-name">${c.userRole==="normal"?"æ™®é€šç”¨æˆ·":c.userRole==="master"?"ä¸»æ§":"æ¸¸å®¢"}</span>
              <span class="comment-time">${c.time}</span>
              <div>${c.content}</div>
            </div>
          `).join("");
        }

        html += `
        <div class="post-card">
          <h3>${post.title}</h3>
          <div class="post-info">å‘å¸ƒäººï¼š${post.author} | å‘å¸ƒæ—¶é—´ï¼š${post.time}</div>
          <div class="post-content">${post.content}</div>
          <button class="like-btn" onclick="likeChannelPost('${post.id}', '${normalUserId}')">â¤ï¸ ç‚¹èµ</button>
          <span class="like-count">å½“å‰${post.likes}èµ</span>
          
          <div class="comment-area">
            <div>ğŸ’¬ è¯„è®ºåŒº</div>
            <textarea class="comment-input" id="cmt_${post.id}" placeholder="è¾“å…¥ä½ çš„è¯„è®ºï¼Œç‚¹å‡»å‘é€"></textarea>
            <button class="comment-btn" onclick="doNormalComment('${post.id}')">å‘é€è¯„è®º</button>
            <div class="comment-list">${commentHtml}</div>
          </div>
        </div>`;
      });
      list.innerHTML = html;
    }
    // é¡µé¢åŠ è½½è‡ªåŠ¨åˆ·æ–°
    window.onload = refreshChannelPosts;
    // 30ç§’è‡ªåŠ¨åˆ·æ–°
    setInterval(refreshChannelPosts, 30000);
  </script>
</body>
</html>